# 21天单词记忆应用 - 需求说明文档

## 项目概述

这是一个基于**21天记忆法**的单词/句子记忆卡片应用，帮助用户通过科学的间隔重复算法高效记忆单词。应用采用 React + TypeScript + Tailwind CSS 构建，所有数据通过 localStorage 本地持久化存储。

---

## 核心功能模块

### 1. 词典页面（Dictionary Page）

**主要功能：**
- 显示记忆卡片，支持按压查看翻译交互
- 记住/忘记按钮操作
- 添加新单词入口
- 底部计数显示

**详细说明：**

#### 1.1 记忆卡片交互（MemoryCard组件）

**状态管理：**
- **常态**：显示单词/句子原文，翻译隐藏
- **按压态**：用户按住卡片时显示翻译内容
- **完成态**：所有今日单词复习完成后显示完成状态

**显示逻辑：**
- 自动识别单词和句子（通过空格判断）
- **单词**：使用大字号显示（40px）
- **句子**：使用小字号显示（20px）
- 翻译内容在按压时淡入显示

**按压交互：**
- 支持鼠标按下/触摸按下事件
- 松手时翻译隐藏
- 使用 `onMouseDown/onMouseUp` 和 `onTouchStart/onTouchEnd` 实现

#### 1.2 记住/忘记按钮

**笑脸按钮（记住）：**
- 单词记忆等级 +1
- 按照 21 天记忆法安排下次复习时间
- 从今日复习列表中移除
- 已记住计数 +1

**难过按钮（忘记）：**
- 重置记忆等级为 0
- 继续留在当前复习列表中
- 移动到下一个单词（循环）

#### 1.3 底部计数显示

格式：`今日X/Y个词汇`
- **X**：已成功记住的单词数（会动态增加）
- **Y**：今日初始需要复习的单词总数（固定值，默认为9）

#### 1.4 添加新单词入口

- 点击输入框打开添加页面
- 显示"英文 ⇄ 中文"语言切换标识（装饰性）
- 提示文字："点击添加新的单词或句子"

---

### 2. 输入页面（InputPage）

**主要功能：**
- 添加新单词或句子
- 自动翻译预测
- 单词推荐与自动补全
- 重复单词检测

**详细说明：**

#### 2.1 单词输入框

**功能特性：**
- 支持多行输入（textarea）
- 清空按钮（X图标，仅在有内容时显示）
- 实时单词预测（延迟300ms）
- 支持连续输入多个单词

**智能预测逻辑：**
- 只对最后一个输入的单词进行预测
- 以空格结尾时清空预测列表
- 从内置词典搜索匹配单词
- 显示单词及其翻译的下拉列表

#### 2.2 单词推荐功能

**推荐列表显示：**
- 白色卡片悬浮显示，带阴影和边框
- 显示匹配的单词及其翻译
- 点击列表外部关闭推荐

**选择推荐词后的行为：**
- ✅ 自动替换当前输入的最后一个单词
- ✅ 自动在选中单词后添加空格
- ✅ 光标自动定位到末尾
- ✅ 输入框保持聚焦状态
- ✅ 用户可以继续输入下一个单词

#### 2.3 翻译输入框

**功能特性：**
- 自动翻译预测（基于单词库）
- 支持手动编辑翻译
- 多行输入支持

#### 2.4 提交逻辑

**验证规则：**
- 检查单词是否已存在（不区分大小写）
- 已存在：显示 Toast 提示"单词已存在"
- 不存在：添加到词库并显示"添加了新单词"

**新单词数据结构：**
```typescript
{
  id: Date.now().toString(),
  word: string,
  translation: string,
  type: word.includes(' ') ? 'sentence' : 'word',
  level: 0,
  nextReviewDate: today,
  lastReviewDate: '',
  createdDate: today,
  reviewCount: 0,
}
```

**添加后的行为：**
- 将新单词插入到当前卡片位置
- 立即在记忆卡片上显示
- 关闭输入页面
- 今日总数 +1

---

### 3. 回顾页面（ReviewPage）

**主要功能：**
- 统计不同时间段的学习数据
- 显示本月/半年/一年新增单词列表
- 查看单词详情

**详细说明：**

#### 3.1 时间周期切换

**三个选项：**
- 一个月
- 半年
- 一年

**选中状态：**
- 蓝色文字（#2563eb）
- 底部蓝色下划线指示器

#### 3.2 统计卡片区域

**布局特性：**
- ✅ 顶部固定显示
- ✅ 左右居中对齐
- ✅ 响应式适配不同屏幕宽度
- ✅ 最大宽度限制 318px

**显示内容：**

1. **新增单词量**
   - 大号蓝色数字显示（40px）
   - 两位数格式（补0）
   - 标签："新增单词量"

2. **回顾次数统计**（横向三个卡片）
   - 2次回顾：显示数量
   - 3次回顾：显示数量
   - 4次回顾：显示数量
   - 浅蓝色背景 `rgba(22,93,255,0.05)`
   - 卡片间用竖线分隔

#### 3.3 新增单词列表

**列表标题：**
- "本月新增" / "半年新增" / "一年新增"
- 固定在统计卡片下方

**单词卡片：**
- 显示"英中"标签（灰色小标签）
- 显示单词原文（粗体，可能截断）
- 显示翻译（灰色，超长时显示省略号）
- 点击查看详情

**省略号显示逻辑：**
- 翻译文本使用 `truncate` 类
- 单词使用 `max-w-[200px]` 限制宽度
- 超长内容自动截断并显示省略号

#### 3.4 单词详情页（WordDetailPage）

**显示内容：**
- 单词/句子原文
- 完整翻译
- 创建日期
- 复习次数
- 当前记忆等级
- 下次复习日期

**返回按钮：**
- 左上角返回箭头
- 点击返回列表视图

---

## 技术实现

### 核心技术栈

```json
{
  "框架": "React 18 + TypeScript",
  "样式": "Tailwind CSS v4",
  "状态管理": "React Hooks (useState, useEffect, useRef)",
  "数据持久化": "localStorage",
  "UI组件": "自定义组件 + Sonner (Toast通知)",
  "构建工具": "Vite"
}
```

### 项目结构

```
/src
  /app
    App.tsx                    # 主应用入口
    /components
      MemoryCard.tsx          # 记忆卡片组件
      CompletionCard.tsx      # 完成状态卡片
      InputPage.tsx           # 输入页面
      ReviewPage.tsx          # 回顾页面
      WordDetailPage.tsx      # 单词详情页
    /utils
      memorySystem.ts         # 记忆系统核心逻辑
      reviewStats.ts          # 统计数据计算
      dictionary.ts           # 词典搜索和翻译
    /data
      wordLibrary.ts          # 内置单词库
  /imports
    svg-*.ts                  # SVG图标资源
```

### 数据结构

#### WordData（单词数据）

```typescript
interface WordData {
  id: string;                 // 唯一标识符
  word: string;               // 单词/句子原文
  translation: string;        // 翻译
  type: 'word' | 'sentence';  // 类型
  level: number;              // 记忆等级 (0-4)
  nextReviewDate: string;     // 下次复习日期 (ISO格式)
  lastReviewDate: string;     // 上次复习日期
  createdDate: string;        // 创建日期
  reviewCount: number;        // 累计回顾次数
}
```

#### ReviewStats（统计数据）

```typescript
interface ReviewStats {
  newWordsCount: number;      // 新增单词数量
  review2Count: number;       // 2次回顾的单词数
  review3Count: number;       // 3次回顾的单词数
  review4Count: number;       // 4次及以上回顾的单词数
  newWords: WordData[];       // 新增单词列表
}
```

---

## 21天记忆法算法

### 记忆等级与复习间隔

```typescript
const REVIEW_INTERVALS = [1, 3, 7, 15, 21];

Level 0 → 1天后复习
Level 1 → 3天后复习
Level 2 → 7天后复习
Level 3 → 15天后复习
Level 4 → 21天后复习
Level 5+ → 365天后（已完成）
```

### 核心函数

#### 1. 计算下次复习日期

```typescript
function calculateNextReviewDate(level: number): string {
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  
  if (level >= REVIEW_INTERVALS.length) {
    today.setDate(today.getDate() + 365); // 已完成
  } else {
    today.setDate(today.getDate() + REVIEW_INTERVALS[level]);
  }
  
  return today.toISOString().split('T')[0];
}
```

#### 2. 判断是否今日复习

```typescript
function shouldReviewToday(word: WordData): boolean {
  const today = getTodayDate();
  return word.nextReviewDate <= today;
}
```

#### 3. 标记为记住

```typescript
function markAsRemembered(word: WordData): WordData {
  const today = getTodayDate();
  const newLevel = word.level + 1;
  
  return {
    ...word,
    level: newLevel,
    lastReviewDate: today,
    nextReviewDate: calculateNextReviewDate(newLevel),
    reviewCount: (word.reviewCount || 0) + 1,
  };
}
```

#### 4. 标记为忘记

```typescript
function markAsForgotten(word: WordData): WordData {
  const today = getTodayDate();
  
  return {
    ...word,
    level: 0,
    lastReviewDate: today,
    nextReviewDate: today, // 继续留在今天
  };
}
```

---

## 响应式设计

### 容器布局

**桌面端：**
- 最大宽度：480px
- 圆角：24px
- 阴影：大阴影效果
- 高度：90vh（最大900px）
- 居中显示

**移动端：**
- 全屏显示 (w-full h-screen)
- 无圆角
- 无阴影
- 底部显示 Home Indicator

### 卡片区域

**词典页面主内容：**
- 使用 flexbox 垂直居中布局
- 卡片和输入框垂直排列，间距 32px (gap-8)
- 水平方向居中对齐
- 左右内边距 5%

**回顾页面统计区域：**
- 顶部固定在 88px 位置
- 左右居中，最大宽度 318px
- 使用 flex-col 垂直布局
- 间距 8px

### 字体大小

```css
标题：clamp(20px, 5vw, 24px)
单词（卡片）：40px
句子（卡片）：20px
翻译：14px
提示文字：clamp(14px, 4vw, 16px)
```

---

## 数据持久化

### localStorage 键名

```
memoryWords: 存储所有单词数据（WordData[]）
```

### 初始化逻辑

1. 首次打开应用时，从单词库中选择前9个单词
2. 这些单词的创建日期设置为**本月第一天**（作为"旧单词"）
3. 所有单词的下次复习日期设置为今天
4. 用户可以立即开始学习

### 数据操作

**保存时机：**
- 点击"记住"按钮
- 点击"忘记"按钮
- 添加新单词

**读取时机：**
- 应用初始化
- 切换到回顾页面

---

## UI/UX 细节

### 颜色系统

```css
主色调（蓝色）: #2563eb
文字主色: #0f172a
文字次要色: #6b7280
占位符: #9ca3af / #cdd3df
背景色: #f5f5f5 / #ffffff
边框: #f3f4f6 / #e5e7eb
阴影卡片: #bbc5e4
```

### 动画与过渡

**卡片切换：**
- 水平滑动动画
- 渐入渐出效果
- 持续时间：300ms

**按压反馈：**
- 翻译淡入淡出
- 过渡时间：200ms

**Toast通知：**
- 居中显示
- 持续时间：2400ms
- 淡入淡出过渡：400ms

### 字体

```css
主字体: 'Segoe UI'
中文字体: 'Noto Sans SC'
日文字体: 'Noto Sans JP'
```

### 交互反馈

**按钮：**
- `hover:opacity-70` 鼠标悬停效果
- `cursor-pointer` 鼠标指针
- 过渡动画：`transition-opacity`

**Toast通知：**
- 成功：绿色背景，"添加了新单词"
- 失败：红色背景，"单词已存在"

---

## 已知功能点

### ✅ 已完成

1. 三个主要页面（词典、回顾、输入）
2. 记忆卡片按压交互
3. 21天记忆算法实现
4. 本地数据持久化
5. 单词推荐与自动补全
6. 统计数据计算（本月/半年/一年）
7. 响应式布局适配
8. 单词详情页
9. 重复单词检测
10. 卡片切换动效
11. 选中推荐词后光标保持
12. 统计区域居中适配
13. 列表省略号显示

### ⚠️ 待优化

1. 词典数据扩充（目前仅有内置单词库）
2. 数据导入/导出功能
3. 学习进度可视化（图表）
4. 自定义复习间隔
5. 深色模式支持
6. 发音功能（TTS）
7. 单词分类标签系统
8. 学习历史记录

---

## 开发建议

### 代码规范

1. 使用 TypeScript 严格类型检查
2. 组件拆分原则：单一职责
3. 使用 Tailwind CSS 内联样式
4. 避免使用相对路径，使用 `@/` 别名
5. 所有日期使用 ISO 格式字符串

### 调试技巧

**清空 localStorage：**
```javascript
localStorage.removeItem('memoryWords');
location.reload();
```

**查看存储数据：**
```javascript
JSON.parse(localStorage.getItem('memoryWords'));
```

**重置为默认数据：**
```javascript
// 在 App.tsx 的 useEffect 中临时添加
localStorage.removeItem('memoryWords');
```

---

## 常见问题解决

### Q1: 单词列表显示"暂无单词"

**原因：** localStorage 数据损坏或今日无复习单词  
**解决：** 清空 localStorage 重新初始化

### Q2: 统计数据不准确

**原因：** createdDate 字段缺失或格式错误  
**解决：** 检查 WordData 的 createdDate 字段

### Q3: 推荐单词不显示

**原因：** wordLibrary 数据为空或搜索逻辑错误  
**解决：** 检查 `/src/app/data/wordLibrary.ts` 是否存在

### Q4: 卡片布局错位

**原因：** 响应式断点冲突  
**解决：** 检查 max-w 和 aspect-ratio 设置

---

## 总结

这是一个功能完善的单词记忆应用，基于科学的间隔重复理论，采用现代化的技术栈和响应式设计。应用通过本地存储实现数据持久化，无需后端服务即可独立运行。

**核心优势：**
- 科学的21天记忆法算法
- 流畅的卡片交互体验
- 完善的数据统计功能
- 优秀的响应式适配

**适合场景：**
- 个人单词学习
- 离线使用
- 移动端和桌面端

---

**文档版本：** v1.0  
**最后更新：** 2025-01-30  
**维护者：** AI Assistant
